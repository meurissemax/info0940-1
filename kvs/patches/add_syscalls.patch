From 2396bfe085c90e56c341f282e4baa2353e98fc7e Mon Sep 17 00:00:00 2001
From: Maxime Meurisse <m.meurisse@student.uliege.be>
Date: Sat, 21 Mar 2020 14:37:57 +0100
Subject: [PATCH 1/3] Setup KVS system calls

---
 Makefile                               |  2 +-
 arch/x86/entry/syscalls/syscall_32.tbl |  3 +++
 include/linux/syscalls.h               |  4 ++++
 kvs/Makefile                           |  1 +
 kvs/kvs.c                              | 40 ++++++++++++++++++++++++++++++++++
 5 files changed, 49 insertions(+), 1 deletion(-)
 create mode 100644 kvs/Makefile
 create mode 100644 kvs/kvs.c

diff --git a/Makefile b/Makefile
index c8b8e90..efe46e6 100644
--- a/Makefile
+++ b/Makefile
@@ -940,7 +940,7 @@ endif
 
 
 ifeq ($(KBUILD_EXTMOD),)
-core-y		+= kernel/ certs/ mm/ fs/ ipc/ security/ crypto/ block/
+core-y		+= kernel/ certs/ mm/ fs/ ipc/ security/ crypto/ block/ kvs/
 
 vmlinux-dirs	:= $(patsubst %/,%,$(filter %/, $(init-y) $(init-m) \
 		     $(core-y) $(core-m) $(drivers-y) $(drivers-m) \
diff --git a/arch/x86/entry/syscalls/syscall_32.tbl b/arch/x86/entry/syscalls/syscall_32.tbl
index 448ac21..9058376 100644
--- a/arch/x86/entry/syscalls/syscall_32.tbl
+++ b/arch/x86/entry/syscalls/syscall_32.tbl
@@ -391,3 +391,6 @@
 382	i386	pkey_free		sys_pkey_free
 383	i386	statx			sys_statx
 384	i386	arch_prctl		sys_arch_prctl			compat_sys_arch_prctl
+385     i386    kvs_insert              kvs_insert
+386     i386    kvs_search              kvs_search
+387     i386    kvs_delete              kvs_delete
diff --git a/include/linux/syscalls.h b/include/linux/syscalls.h
index a78186d..bb840d7 100644
--- a/include/linux/syscalls.h
+++ b/include/linux/syscalls.h
@@ -941,4 +941,8 @@ asmlinkage long sys_pkey_free(int pkey);
 asmlinkage long sys_statx(int dfd, const char __user *path, unsigned flags,
 			  unsigned mask, struct statx __user *buffer);
 
+asmlinkage long kvs_insert(const char* key, size_t keylen, const char* val, size_t vallen);
+asmlinkage long kvs_search(const char* key, size_t keylen, char* val, size_t max_vallen);
+asmlinkage long kvs_delete(const char* key, size_t keylen);
+
 #endif
diff --git a/kvs/Makefile b/kvs/Makefile
new file mode 100644
index 0000000..785fb42
--- /dev/null
+++ b/kvs/Makefile
@@ -0,0 +1 @@
+obj-y := kvs.o
diff --git a/kvs/kvs.c b/kvs/kvs.c
new file mode 100644
index 0000000..b81ac24
--- /dev/null
+++ b/kvs/kvs.c
@@ -0,0 +1,40 @@
+/**
+ * INFO0940-1 - Operating systems
+ * University of Liege
+ * Academic year 2019-2020
+ *
+ * Group 1
+ * 20161278 - MEURISSE Maxime
+ * 20162864 - VERMEYLEN Valentin
+ */
+
+/***********/
+/* Headers */
+/***********/
+
+#include <linux/kernel.h>
+#include <include/linux/types.h>
+
+
+/*************/
+/* Functions */
+/*************/
+
+asmlinkage long kvs_insert(const char* key, size_t keylen, const char* val, size_t vallen) {
+	printk("KVS insert.\n");
+
+	return 0;
+}
+
+asmlinkage long kvs_search(const char* key, size_t keylen, char* val, size_t max_vallen) {
+	printk("KVS search.\n");
+
+	return 0;
+}
+
+asmlinkage long kvs_delete(const char* key, size_t keylen) {
+	printk("KVS delete.\n");
+
+	return 0;
+}
+
-- 
2.7.4


From b5bf324abf774ad26744857ab95a35714ce926cf Mon Sep 17 00:00:00 2001
From: Maxime Meurisse <m.meurisse@student.uliege.be>
Date: Sat, 21 Mar 2020 15:14:23 +0100
Subject: [PATCH 2/3] Small fixes to add system calls

---
 kvs/kvs.c | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/kvs/kvs.c b/kvs/kvs.c
index b81ac24..67b76cf 100644
--- a/kvs/kvs.c
+++ b/kvs/kvs.c
@@ -13,7 +13,7 @@
 /***********/
 
 #include <linux/kernel.h>
-#include <include/linux/types.h>
+#include <linux/types.h>
 
 
 /*************/
@@ -37,4 +37,3 @@ asmlinkage long kvs_delete(const char* key, size_t keylen) {
 
 	return 0;
 }
-
-- 
2.7.4


From a3fa3da9c422534229155391afc2aff1509de1ee Mon Sep 17 00:00:00 2001
From: Maxime Meurisse <m.meurisse@student.uliege.be>
Date: Sat, 21 Mar 2020 15:16:11 +0100
Subject: [PATCH 3/3] Update Makefile of KVS

---
 kvs/Makefile | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/kvs/Makefile b/kvs/Makefile
index 785fb42..35c855b 100644
--- a/kvs/Makefile
+++ b/kvs/Makefile
@@ -1 +1 @@
-obj-y := kvs.o
+obj-y:=kvs.o
-- 
2.7.4

